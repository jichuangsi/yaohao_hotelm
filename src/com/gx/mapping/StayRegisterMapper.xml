<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.gx.dao.StayRegisterDao" >
  <resultMap id="BaseResultMap" type="com.gx.po.StayRegisterPo" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sun Oct 16 19:18:30 CST 2016.
    -->
    <constructor >
      <idArg column="id" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="predetermineID" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="rentOutTypeID" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="roomID" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="payWayID" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="billUnitID" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="passengerTypeID" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="receiveTargetID" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="deputyID" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="isBillID" jdbcType="INTEGER" javaType="java.lang.Integer" />
      <arg column="registerTime" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp" />
      <arg column="stayNumber" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="sumConst" jdbcType="DOUBLE" javaType="java.lang.Double" />
      <arg column="changingRoomNumber" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="changRoomMoney" jdbcType="DOUBLE" javaType="java.lang.Double" />
      <arg column="remarks" jdbcType="VARCHAR" javaType="java.lang.String" />
      <arg column="payTime" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp" />
      <arg column="changRoomTime" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp" />
      <arg column="remind" jdbcType="INTEGER" javaType="java.lang.Integer" />
        <arg column="isdicount" jdbcType="INTEGER" javaType="java.lang.Integer" />
        <arg column="renshu" jdbcType="INTEGER" javaType="java.lang.Integer" />

        <arg column="checkintime" jdbcType="DATE" javaType="java.sql.Date" />
        <arg column="checkouttime" jdbcType="DATE" javaType="java.sql.Date" />
        <arg column="accountsreceivable" jdbcType="DOUBLE" javaType="java.lang.Double" />
        <arg column="currency" jdbcType="INTEGER" javaType="java.lang.Integer" />
        <arg column="isdao" jdbcType="INTEGER" javaType="java.lang.Integer" />
        <arg column="paymentdate" jdbcType="TIMESTAMP" javaType="java.sql.Timestamp" />
    </constructor>
  </resultMap>

<!--   新增 -->

    <insert id="insertAll" useGeneratedKeys="true" keyProperty="id" parameterType="com.gx.po.StayRegisterPo" >

       INSERT INTO stayregister (roomID,rentOutTypeID,passengerTypeID,billUnitID,
     receiveTargetID,isBillID,registerTime,stayNumber,sumConst,isdicount,renshu,checkintime,checkouttime,
     accountsreceivable,currency,isdao,paymentdate)
     values (#{roomID,jdbcType=INTEGER},
             #{rentOutTypeID,jdbcType=INTEGER},
             #{passengerTypeID,jdbcType=INTEGER},
             #{billUnitID,jdbcType=INTEGER},
             #{receiveTargetID,jdbcType=INTEGER},
             #{isBillID,jdbcType=INTEGER},
             #{registerTime,jdbcType=TIMESTAMP},
             #{stayNumber,jdbcType=VARCHAR},
             #{sumConst,jdbcType=DOUBLE},
              #{isdicount,jdbcType=INTEGER},
               #{renshu,jdbcType=INTEGER},
                #{checkintime,jdbcType=DATE},
             #{checkouttime,jdbcType=DATE},
             #{accountsreceivable,jdbcType=DOUBLE},
             #{currency,jdbcType=INTEGER},
              #{isdao,jdbcType=INTEGER},
               #{paymentdate,jdbcType=TIMESTAMP})
  </insert>

  <!--   修改要用的精确查询 -->
   <select id="selectById" resultType="com.gx.po.StayRegisterPo" parameterType="java.lang.Integer">
     SELECT s.* ,r.`roomNumber` AS roomNumber
	FROM stayregister s
	INNER JOIN `room` r ON r.`id`=s.`roomID`
	where s.id=#{id,jdbcType=INTEGER}
   </select>
 
<!-- 新增住宿明细 -->
  <insert id="insertStayregisterdetails" >

       INSERT INTO stayregisterdetails (stayRegisterID,passengerID,codeNumber,platformID)
     values (#{stayRegisterID,jdbcType=INTEGER},
             #{passengerID,jdbcType=INTEGER},
            #{codeNumber,jdbcType=VARCHAR},
            #{platformID,jdbcType=INTEGER})
  </insert>
  
<!-- 新增押金明细 -->
  <insert id="insertDeposit" parameterType="com.gx.po.StayRegisterPo">
       INSERT INTO depoit (stayRegisterID,payWayID,registerTime,deposit,depoiststatus)
     values (#{depositStayRegisterID,jdbcType=INTEGER},
             #{depositPayWayID,jdbcType=INTEGER},
             #{depositRegisterTime,jdbcType=TIMESTAMP},
             #{deposit,jdbcType=DOUBLE}, #{depoiststatus,jdbcType=DOUBLE})
  </insert>  
 
 
 <!-- 查询押金明细   -->
   <select id="selectDepositById" resultType="com.gx.po.StayRegisterPo" parameterType="java.lang.Integer">
      SELECT s.*,d.deposit,d.registerTime AS depositRegisterTime,a.attributeDetailsName AS depositPayWayName,
    rt.teamName AS receiveTeamName, ar.attributeDetailsName AS receiveTargeTypeName,
	r.roomNumber,b.attributeDetailsName AS rentOutTypeName,d.depoiststatus AS depoiststatus
	FROM stayregister s INNER JOIN depoit d ON s.id=d.stayRegisterID 
	INNER JOIN attributedetails a ON d.payWayID=a.id
	INNER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	INNER JOIN attributedetails ar ON rt.targetTypeID=ar.id
	INNER JOIN room r ON s.roomID=r.id
	INNER JOIN attributedetails b ON s.rentOutTypeID=b.id
	where s.id=#{id,jdbcType=INTEGER}
   </select>
   
   
  <!-- 新增消费明细 -->
  <insert id="insertConsumptiondetails" parameterType="com.gx.po.StayRegisterPo">
       INSERT INTO consumptiondetails (stayRegisterID,commodityID,consumptionNumber,consumptionMoney,consumptionTime)
     values (#{consumptionStayRegisterID,jdbcType=INTEGER},
             #{consumptionCommodityID,jdbcType=INTEGER},
             #{consumptionNumber,jdbcType=VARCHAR},
             #{consumptionMoney,jdbcType=DOUBLE},
             #{consumptionTime,jdbcType=TIMESTAMP})
  </insert>
   
   
   <!-- 无条件的分页查询 消费明细 -->
   <select id="pageConsumption" resultType="com.gx.po.StayRegisterPo">
	  SELECT s.*,r.roomNumber,cpd.id AS consumptionId,cpd.consumptionNumber,cpd.consumptionMoney,
	cpd.consumptionTime,c.commodityName,c.salePrice AS commoditySalePrice,
	a.attributeDetailsName AS commodityUOMName
	FROM stayregister s INNER JOIN room r ON s.roomID=r.id
	LEFT OUTER JOIN consumptiondetails cpd ON s.id=cpd.stayRegisterID
	LEFT OUTER JOIN commodity c ON cpd.commodityID=c.id
	LEFT OUTER JOIN attributedetails a ON c.uOMID=a.id
	WHERE cpd.stayRegisterID=#{consumptionStayRegisterID,jdbcType=INTEGER}
	limit #{start},#{pageSize}
   </select>
   
   <!-- 无条件的分页查询 消费明细  查询总条数  -->
   <select id="countConsumption" resultType="java.lang.Integer">
	   SELECT count(*) FROM stayregister s INNER JOIN room r ON s.roomID=r.id
	LEFT OUTER JOIN consumptiondetails cpd ON s.id=cpd.stayRegisterID
	LEFT OUTER JOIN commodity c ON cpd.commodityID=c.id
	LEFT OUTER JOIN attributedetails a ON c.uOMID=a.id
	WHERE cpd.stayRegisterID=#{consumptionStayRegisterID,jdbcType=INTEGER}
   </select>
   
   <delete id="deleteConsumption" parameterType="java.lang.Integer">
      DELETE FROM consumptiondetails WHERE id = #{id,jdbcType=INTEGER}
   </delete>
 
   <!--  修改总费用 -->
   <update id="updateSumConst" >
     UPDATE stayregister SET sumConst=#{sumConst,jdbcType=DOUBLE}
     WHERE id = #{id,jdbcType=INTEGER}
   </update>
 
<!--    查询用于计算房间加商品消费 -->
   <select id="selectMoney" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,cpd.consumptionMoney,r.standardPriceDay AS roomStandardPriceDay,
	r.standardPrice AS roomStandardPrice,r.maxDuration AS roomMaxDuration,
	r.firstDuration AS roomFirstDuration,r.firstPrice AS roomFirstPrice
	FROM stayregister s LEFT OUTER JOIN consumptiondetails cpd ON s.id=cpd.stayRegisterID
	LEFT OUTER JOIN room r ON s.roomID=r.id
	WHERE s.id = #{id,jdbcType=INTEGER}
  </select>
   
 
 <!--    查询用于计算房间加商品消费 -->
   <select id="selectChangRoom" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,r.roomNumber,r.standardPriceDay AS roomStandardPriceDay,
	a.attributeDetailsName AS receiveTargeTypeName,d.deposit,
	ar.attributeDetailsName AS rentOutTypeName,
	rt.teamName AS receiveTeamName,r.bedDayPrice as bedDayPrice
	FROM stayregister s LEFT OUTER JOIN room r ON s.roomID=r.id
	LEFT OUTER JOIN attributedetails ar ON s.rentOutTypeID=ar.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails a ON rt.targetTypeID=a.id
	LEFT OUTER JOIN depoit d ON d.stayRegisterID=s.id
	WHERE s.id = #{id,jdbcType=INTEGER}
  </select>
 
   <select id="selectAll" resultType="com.gx.po.StayRegisterPo">
    SELECT s.*,p.name AS passengerName,r.roomNumber AS RoomNumber,a.attributeDetailsName AS RoomGuestRoomLevelName,
	aa.attributeDetailsName AS predetermineReceiveTargeTypeName,ab.attributeDetailsName AS passengerTypeName,
	su.`supplierName` AS supplierName,ss.`codeNumber` AS codeNumber,pl.`name` AS platformName
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
	INNER JOIN `platform` pl ON pl.id=ss.`platformID`
    WHERE s.isBillID=68
  </select>
  
  <select id="selectShuJuTongJi" resultType="com.gx.po.StayRegisterPo">
      SELECT s.* FROM stayregister s
    WHERE s.isBillID=69   and s.payTime BETWEEN #{min} AND #{max}
  </select>
 
 
 <!--  修改总费用 -->
   <update id="updateRemind" >
     UPDATE stayregister SET remind=#{remind,jdbcType=INTEGER}
     WHERE id = #{id,jdbcType=INTEGER}
   </update>
 
 
 
 <!--  换房 -->
   <update id="updateChangRoom" parameterType="com.gx.po.StayRegisterPo">
     UPDATE stayregister SET roomID=#{roomID,jdbcType=INTEGER},
						     sumConst=#{sumConst,jdbcType=DOUBLE},
						     changingRoomNumber=#{changingRoomNumber,jdbcType=VARCHAR},
						     changRoomMoney=#{changRoomMoney,jdbcType=DOUBLE},
						     changRoomTime=#{changRoomTime,jdbcType=TIMESTAMP}
     WHERE id = #{id,jdbcType=INTEGER}
   </update>
   
   <!--  结账-->
   <update id="pay" >
     UPDATE stayregister SET remarks=#{remarks,jdbcType=VARCHAR},
						     payTime=#{payTime,jdbcType=TIMESTAMP},
						     payWayID=#{payWay,jdbcType=INTEGER},
						     isBillID=69
     WHERE id = #{id,jdbcType=INTEGER}
   </update>
   
   <!--   根据 团队id来查询 总费用， -->
   <select id="selectFormTeamId" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,p.name AS passengerName,COUNT(DISTINCT r.roomNumber),r.roomNumber,
    r.standardPriceDay AS roomStandardPriceDay,r.standardPrice AS roomStandardPrice,
    a.attributeDetailsName AS roomGuestRoomLevelName,
   	aa.attributeDetailsName AS predetermineReceiveTargeTypeName,
	ab.attributeDetailsName AS passengerTypeName, rt.teamName AS receiveTeamName,
	rt.teamCode AS receiveTeamCode,rt.principal AS receivePrincipal,
	ac.attributeDetailsName AS rentOutTypeName
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID 
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id 
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id 
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	LEFT OUTER JOIN attributedetails ac ON s.rentOutTypeID=ac.id
    WHERE s.receiveTargetID=#{receiveTargetID,jdbcType=INTEGER}
    AND s.isBillID=#{isBillID,jdbcType=INTEGER} GROUP BY r.roomNumber
  </select>
  
  
   <select id="selectFormTeamIdTwo" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,p.name AS passengerName,r.roomNumber,r.standardPriceDay AS roomStandardPriceDay,
        r.standardPrice AS roomStandardPrice, a.attributeDetailsName AS roomGuestRoomLevelName,
	aa.attributeDetailsName AS predetermineReceiveTargeTypeName,
	ab.attributeDetailsName AS passengerTypeName, rt.teamName AS receiveTeamName,
	rt.teamCode AS receiveTeamCode,rt.principal AS receivePrincipal,
	ac.attributeDetailsName AS rentOutTypeName
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID 
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id 
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id 
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	LEFT OUTER JOIN attributedetails ac ON s.rentOutTypeID=ac.id 
    WHERE s.receiveTargetID!=2
    AND s.isBillID=#{isBillID,jdbcType=INTEGER} 
  </select>
  
  
  <!--   根据 团队id 来查询 押金， -->
   <select id="selectTeamDeposit" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,r.teamName AS receiveTeamName,d.deposit
	FROM stayregister s LEFT OUTER JOIN receivetarget r ON s.receiveTargetID=r.id
	LEFT OUTER JOIN depoit d ON s.id=d.stayRegisterID
    WHERE s.receiveTargetID=#{receiveTargetID,jdbcType=INTEGER}
    AND s.isBillID=68 
  </select>
  
  
  <!--   根据团队id 来查询 旅客消费， -->
   <select id="selectTeamConsumption" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,r.teamName AS receiveTeamName,c.consumptionMoney
	FROM stayregister s LEFT OUTER JOIN receivetarget r ON s.receiveTargetID=r.id
	LEFT OUTER JOIN consumptiondetails c ON s.id=c.stayRegisterID
    WHERE s.receiveTargetID=#{receiveTargetID,jdbcType=INTEGER}
    AND s.isBillID=68
  </select>
  
   <!--   Ajax 根据 团队id 的 房间号来查询， -->
   <select id="ajaxSelectTeamRoom" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,p.name AS passengerName,r.roomNumber,r.standardPriceDay AS roomStandardPriceDay,
      r.standardPrice AS roomStandardPrice, a.attributeDetailsName AS roomGuestRoomLevelName,
	aa.attributeDetailsName AS predetermineReceiveTargeTypeName,
	ab.attributeDetailsName AS passengerTypeName, rt.teamName AS receiveTeamName,
	rt.teamCode AS receiveTeamCode,rt.principal AS receivePrincipal,
	ac.attributeDetailsName AS rentOutTypeName
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID 
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id 
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id 
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	LEFT OUTER JOIN attributedetails ac ON s.rentOutTypeID=ac.id 
    WHERE s.receiveTargetID=#{receiveTargetID,jdbcType=INTEGER}
    AND s.isBillID=68 AND r.roomNumber like CONCAT('%',#{roomNumber,jdbcType=VARCHAR},'%')
  </select>
  
  
  
  
  
  
  
  
  <!--   Ajax 根据团队 id 和时间段来查询， -->
   <select id="ajaxSelectTeamFormTime" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,p.name AS passengerName,COUNT(DISTINCT r.roomNumber),r.roomNumber,
    r.standardPriceDay AS roomStandardPriceDay,r.standardPrice AS roomStandardPrice,
    a.attributeDetailsName AS roomGuestRoomLevelName,
   	aa.attributeDetailsName AS predetermineReceiveTargeTypeName,
	ab.attributeDetailsName AS passengerTypeName, rt.teamName AS receiveTeamName,
	rt.teamCode AS receiveTeamCode,rt.principal AS receivePrincipal,
	ac.attributeDetailsName AS rentOutTypeName
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID 
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id 
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id 
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	LEFT OUTER JOIN attributedetails ac ON s.rentOutTypeID=ac.id
    WHERE s.receiveTargetID=#{receiveTargetID,jdbcType=INTEGER}
    AND s.isBillID=68 AND  s.registerTime BETWEEN #{min} AND #{max} GROUP BY r.roomNumber
  </select>
  
  
  <!--   根据 团队id 时间段来查询 押金， -->
   <select id="ajaxSelectTeamDeposit" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,r.teamName AS receiveTeamName,d.deposit
	FROM stayregister s LEFT OUTER JOIN receivetarget r ON s.receiveTargetID=r.id
	LEFT OUTER JOIN depoit d ON s.id=d.stayRegisterID
    WHERE s.receiveTargetID=#{receiveTargetID,jdbcType=INTEGER}
    AND s.isBillID=68 AND  s.registerTime BETWEEN #{min} AND #{max}
  </select>
  
  
  <!--   根据团队id 时间段来查询 旅客消费， -->
   <select id="ajaxSelectTeamConsumption" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,r.teamName AS receiveTeamName,c.consumptionMoney
	FROM stayregister s LEFT OUTER JOIN receivetarget r ON s.receiveTargetID=r.id
	LEFT OUTER JOIN consumptiondetails c ON s.id=c.stayRegisterID
    WHERE s.receiveTargetID=#{receiveTargetID,jdbcType=INTEGER}
    AND s.isBillID=68 AND  s.registerTime BETWEEN #{min} AND #{max}
  </select>
  
  
  
  
  
  
  <!--   根据 住宿登记id 来查询 详情信息  详情版 用于 转入团队， -->
   <select id="selectInformationXiangQingBan" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,r.roomNumber,r.standardPriceDay AS roomStandardPriceDay,
	r.standardPrice AS roomStandardPrice,r.firstPrice AS roomFirstPrice,
	rt.teamName AS receiveTeamName,p.name AS passengerName,
	sa.attributeDetailsName AS passengerTypeName,
	pa.attributeDetailsName AS passengerLevelName,sb.attributeDetailsName AS billUnitName,
	sc.attributeDetailsName AS rentOutTypeName,sd.attributeDetailsName AS payWayName
	FROM stayregister s LEFT OUTER JOIN room r ON s.roomID=r.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN stayregisterdetails st ON st.stayRegisterID=s.id
	LEFT OUTER JOIN passenger p ON st.passengerID=p.id
	LEFT OUTER JOIN attributedetails sa ON s.passengerTypeID=sa.id
	LEFT OUTER JOIN attributedetails pa ON p.passengerLevelID=pa.id
	LEFT OUTER JOIN attributedetails sb ON s.billUnitID=sb.id
	LEFT OUTER JOIN attributedetails sc ON s.rentOutTypeID=sc.id
	LEFT OUTER JOIN attributedetails sd ON s.payWayID=sd.id
	WHERE st.id=#{id,jdbcType=INTEGER}
  </select>
  
  <!--  根据 住宿登记id 来查询 押金 精简版 用于 转入团队， -->
   <select id="selectDepositJinJianBan" resultType="com.gx.po.StayRegisterPo">
      SELECT s.id,d.deposit	FROM stayregister s LEFT OUTER JOIN depoit d ON s.id=d.stayRegisterID
    WHERE s.id=#{id,jdbcType=INTEGER}
  </select>
  
  <!--   根据 住宿登记id 来查询 消费 精简版 用于 转入团队， -->
   <select id="selectConsumptionJinJianBan" resultType="com.gx.po.StayRegisterPo">
      SELECT s.id,c.consumptionMoney
    FROM stayregister s LEFT OUTER JOIN consumptiondetails c ON s.id=c.stayRegisterID
    WHERE s.id=#{id,jdbcType=INTEGER}
  </select>
  
  
  <!--   根据 住宿登记id 来查询 总费用 -->
   <select id="selectSumconst" resultType="com.gx.po.StayRegisterPo">
      SELECT s.* FROM stayregister s WHERE s.id=#{id,jdbcType=INTEGER}
  </select>
  
  
  
  
   <!--  修改转入团队或散客 -->
   <update id="changOverTeam" >
     UPDATE stayregister SET receiveTargetID=#{receiveTargetID,jdbcType=INTEGER}
     WHERE id = #{id,jdbcType=INTEGER}
   </update>
  

  <!--  修改 预定id-->
   <update id="updateStayRegisterPredetermineID" >
     UPDATE stayregister SET predetermineID=#{predetermineID}
     WHERE id = #{id}
   </update>
  
  
   <!--   分页条件查询 One -->
   <select id="pageFuzzyselectOne" resultType="com.gx.po.StayRegisterPo">
       SELECT s.*,p.name AS passengerName,r.roomNumber,r.roomAmount,
	    a.attributeDetailsName AS RoomGuestRoomLevelName, ss.id AS stayregisterdetailsId,
	    aa.attributeDetailsName AS predetermineReceiveTargeTypeName,
	    ab.attributeDetailsName AS passengerTypeName,rt.teamName AS receiveTeamName,
	    s.predetermineID AS predetermineID,su.`supplierName` AS supplierName
	    ,ss.`codeNumber` AS `codeNumber`
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
    WHERE rt.targetTypeID=#{receiveTargeTypeID,jdbcType=INTEGER}
    AND s.isBillID=#{isBillID,jdbcType=INTEGER}
    and r.roomNumber like CONCAT('%',#{roomNumber,jdbcType=VARCHAR},'%')
    ORDER BY s.registerTime DESC
    limit #{start},#{pageSize}
  </select>
  
  <!--   分页条件查询总行数 One -->
   <select id="countFuzzyselectOne" resultType="java.lang.Integer">
      SELECT count(*) FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID 
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id 
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id 
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
    WHERE rt.targetTypeID=#{receiveTargeTypeID,jdbcType=INTEGER}
    AND s.isBillID=#{isBillID,jdbcType=INTEGER}
    and r.roomNumber like CONCAT('%',#{roomNumber,jdbcType=VARCHAR},'%')
    ORDER BY s.registerTime DESC 
  </select>
  
  
  <!--   分页条件查询 Two -->
   <select id="pageFuzzyselectTwo" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,p.name AS passengerName,r.roomNumber,r.roomAmount,
    a.attributeDetailsName AS RoomGuestRoomLevelName, ss.id AS stayregisterdetailsId,
    aa.attributeDetailsName AS predetermineReceiveTargeTypeName,
    ab.attributeDetailsName AS passengerTypeName,rt.teamName AS receiveTeamName,s.predetermineID as predetermineID
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID 
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id 
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id 
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
    WHERE s.receiveTargetID=#{receiveTargetID,jdbcType=INTEGER}
    AND s.isBillID=#{isBillID,jdbcType=INTEGER} 
    and r.roomNumber like CONCAT('%',#{roomNumber,jdbcType=VARCHAR},'%')
    ORDER BY s.registerTime DESC
    limit #{start},#{pageSize}
  </select>
  
  <!--   分页条件查询总行数 Two -->
   <select id="countFuzzyselectTwo" resultType="java.lang.Integer">
      SELECT count(*) FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID 
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id 
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id 
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
    WHERE s.receiveTargetID=#{receiveTargetID,jdbcType=INTEGER}
    AND s.isBillID=#{isBillID,jdbcType=INTEGER}
    and r.roomNumber like CONCAT('%',#{roomNumber,jdbcType=VARCHAR},'%')
    ORDER BY s.registerTime DESC 
  </select>
  
  <!--   分页条件查询 Three -->
   <select id="pageFuzzyselectThree" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,p.name AS passengerName,r.roomNumber,r.roomAmount,
    a.attributeDetailsName AS RoomGuestRoomLevelName, ss.id AS stayregisterdetailsId,
    aa.attributeDetailsName AS predetermineReceiveTargeTypeName,
    ab.attributeDetailsName AS passengerTypeName,rt.teamName AS receiveTeamName,s.predetermineID as predetermineID
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID 
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id 
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id 
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
    WHERE s.receiveTargetID!=2
    AND s.isBillID=#{isBillID,jdbcType=INTEGER} 
    and r.roomNumber like CONCAT('%',#{roomNumber,jdbcType=VARCHAR},'%')
    ORDER BY s.registerTime DESC
    limit #{start},#{pageSize}
  </select>
  
  <!--   分页条件查询总行数 Three -->
   <select id="countFuzzyselectThree" resultType="java.lang.Integer">
      SELECT count(*) FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID 
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id 
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id 
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
    WHERE s.receiveTargetID!=2
    AND s.isBillID=#{isBillID,jdbcType=INTEGER}
    and r.roomNumber like CONCAT('%',#{roomNumber,jdbcType=VARCHAR},'%')
    ORDER BY s.registerTime DESC 
  </select>
  
  <!-- FinancialStatistics -->
  
  <!--   分页条件查询 Four -->
   <select id="pageFuzzyselectFour" resultType="com.gx.po.StayRegisterPo">
     SELECT s.*,p.name AS passengerName,r.roomNumber,su.supplierName AS supplierName,pl.`name` AS platformName,
	    ss.id AS stayregisterdetailsId,ss.`codeNumber` AS codeNumber
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
	INNER JOIN `platform` pl ON pl.`id`=ss.`platformID`
    WHERE s.isBillID=69 ORDER BY s.registerTime DESC
    limit #{start},#{pageSize}
  </select>
  
  <!--   分页条件查询总行数 Four -->
   <select id="countFuzzyselectFour" resultType="java.lang.Integer">
      SELECT count(*) FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID 
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id 
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id 
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
    WHERE s.isBillID=69 ORDER BY s.registerTime DESC 
  </select>
  
  <!--   分页条件查询 Five -->
   <select id="pageFuzzyselectFive" resultType="com.gx.po.StayRegisterPo">
       SELECT s.*,p.name AS passengerName,r.roomNumber,su.supplierName AS supplierName,pl.`name` AS platformName,
	    ss.id AS stayregisterdetailsId,ss.`codeNumber`AS codeNumber
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
	INNER JOIN `platform` pl ON pl.`id`=ss.`platformID`
    WHERE s.isBillID=69
 AND s.payTime BETWEEN #{min} AND #{max} ORDER BY s.registerTime DESC
    limit #{start},#{pageSize}
  </select>
  
  <!--   分页条件查询总行数 Five -->
   <select id="countFuzzyselectFive" resultType="java.lang.Integer">
      SELECT count(*) FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID 
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id 
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id 
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
	INNER JOIN `platform` pl ON pl.`id`=ss.`platformID`
    WHERE s.isBillID=69 AND s.payTime BETWEEN #{min} AND #{max} ORDER BY s.registerTime DESC
  </select>
  
  
  <!--  根据 已结账 来查询 总费用 精简版条件 无条件，人民币 -->
   <select id="selectPayJingJianBanNot" resultType="com.gx.po.StayRegisterPo">
      SELECT s.* FROM stayregister s WHERE s.isBillID=69 AND isdao=2 AND currency=1
  </select>
    <!--  根据 已结账 来查询 总费用 精简版条件 无条件， -->
    <select id="selectPayJingJianBanNotf" resultType="com.gx.po.StayRegisterPo">
      SELECT s.* FROM stayregister s WHERE s.isBillID=69 AND isdao=2 AND currency=2
  </select>
  
  <!--  根据 已结账 来查询 住店人数。无条件， -->
   <select id="selectPayStayNumberNot" resultType="com.gx.po.StayRegisterPo">
       SELECT	s.* FROM stayregister s 
	LEFT OUTER JOIN stayregisterdetails sd ON s.id=sd.stayRegisterID
	LEFT OUTER JOIN passenger p ON sd.passengerID=p.id
	WHERE s.isBillID=69
  </select>
  
  <!--   根据 已结账 来查询 旅客总消费。无条件， -->
   <!--<select id="selectPayXiaoFeiNot" resultType="com.gx.po.StayRegisterPo">
      SELECT s.id,c.consumptionMoney
    FROM stayregister s LEFT OUTER JOIN consumptiondetails c ON s.id=c.stayRegisterID
    WHERE s.isBillID=69
  </select>-->
    <select id="selectPayXiaoFeiNot" resultType="com.gx.po.StayRegisterPo">
      SELECT *
    FROM stayregister
    WHERE isBillID=69 AND currency=1
  </select>
    <select id="selectPayXiaoFeiNotf" resultType="com.gx.po.StayRegisterPo">
      SELECT *
    FROM stayregister
    WHERE isBillID=69 AND currency=2
  </select>
  
  
  
  <!--  根据 已结账 来查询 总费用 精简版条件 结账区段， -->
   <select id="selectPayJingJianBan" resultType="com.gx.po.StayRegisterPo">
      SELECT s.* FROM stayregister s 
      WHERE s.isBillID=69 AND isdao=2 AND currency=1 AND s.payTime BETWEEN #{min} AND #{max}
  </select>
    <!--  根据 已结账 来查询 总费用 精简版条件 结账区段， -->
    <select id="selectPayJingJianBanf" resultType="com.gx.po.StayRegisterPo">
      SELECT s.* FROM stayregister s
      WHERE s.isBillID=69 AND isdao=2 AND currency=2 AND s.payTime BETWEEN #{min} AND #{max}
  </select>
  
  <!--  根据 已结账 来查询 住店人数。条件 结账区段， -->
   <select id="selectPayStayNumber" resultType="com.gx.po.StayRegisterPo">
       SELECT	s.* FROM stayregister s 
	LEFT OUTER JOIN stayregisterdetails sd ON s.id=sd.stayRegisterID
	LEFT OUTER JOIN passenger p ON sd.passengerID=p.id
	WHERE s.isBillID=69 AND s.payTime BETWEEN #{min} AND #{max}
  </select>
  
  <!--   根据 已结账 来查询 旅客总消费。条件 结账区段， -->

    <select id="selectPayXiaoFei" resultType="com.gx.po.StayRegisterPo">
      SELECT *
    FROM stayregister s
    WHERE isBillID=69  AND currency=1 AND s.payTime BETWEEN #{min} AND #{max}
  </select>
    <select id="selectPayXiaoFeif" resultType="com.gx.po.StayRegisterPo">
      SELECT *
    FROM stayregister s
    WHERE isBillID=69  AND currency=2 AND s.payTime BETWEEN #{min} AND #{max}
  </select>
  
  <!--   根据 id 查询 很多很多的信息 -->
   <select id="selectAllInformation" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,r.roomNumber,r.standardPriceDay AS roomStandardPriceDay,
	r.standardPrice AS roomStandardPrice,r.firstPrice AS roomFirstPrice,
	se.attributeDetailsName AS roomGuestRoomLevelName,
	rt.teamName AS receiveTeamName,rt.teamCode AS receiveTeamCode,
	rt.principal AS receivePrincipal,rt.contactPhoneNUmber AS receiveContactPhoneNUmber,
	p.name AS passengerName,sg.attributeDetailsName AS passengerGenderName,
	p.contactPhoneNumber AS pssengerContactPhoneNumber,
	sa.attributeDetailsName AS passengerTypeName,
	sb.attributeDetailsName AS billUnitName,
	sc.attributeDetailsName AS rentOutTypeName,sd.attributeDetailsName AS payWayName,
	ydp.name AS predeterminePassengerName,
	ydp.contactPhoneNumber AS predeterminePassengerContactPhoneNumber
	FROM stayregister s LEFT OUTER JOIN room r ON s.roomID=r.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN stayregisterdetails st ON st.stayRegisterID=s.id
	LEFT OUTER JOIN passenger p ON st.passengerID=p.id
	LEFT OUTER JOIN attributedetails sa ON s.passengerTypeID=sa.id
	LEFT OUTER JOIN attributedetails sb ON s.billUnitID=sb.id
	LEFT OUTER JOIN attributedetails sc ON s.rentOutTypeID=sc.id
	LEFT OUTER JOIN attributedetails sd ON s.payWayID=sd.id
	LEFT OUTER JOIN attributedetails se ON r.guestRoomLevelID=se.id
	LEFT OUTER JOIN predetermine yd ON yd.id=s.predetermineID
	LEFT OUTER JOIN passenger ydp ON yd.passengerID=ydp.id
	LEFT OUTER JOIN attributedetails sg ON p.genderID=sg.id
	WHERE st.id=#{id,jdbcType=INTEGER}
  </select>
  
  
   <select id="selectXiaoFeiMingXi" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,r.roomNumber,cpd.id AS consumptionId,cpd.consumptionNumber,cpd.consumptionMoney,
	cpd.consumptionTime,c.commodityName,c.salePrice AS commoditySalePrice,
	a.attributeDetailsName AS commodityUOMName,b.attributeDetailsName AS commodityTypeName
	FROM stayregister s INNER JOIN room r ON s.roomID=r.id
	LEFT OUTER JOIN consumptiondetails cpd ON s.id=cpd.stayRegisterID
	LEFT OUTER JOIN commodity c ON cpd.commodityID=c.id
	LEFT OUTER JOIN attributedetails a ON c.uOMID=a.id
    LEFT OUTER JOIN attributedetails b ON c.commodityTypeID=b.id
	WHERE s.id=#{id,jdbcType=INTEGER}
  </select>



    <!--  修改 预定id-->
    <update id="updateDepoit" >
     UPDATE depoit SET depoiststatus=#{depoist}
     WHERE stayRegisterID = #{id}
   </update>

    <!--  ======================================================================================================= =========-->
    <select id="roomConsumption" resultType="com.gx.po.StayRegisterPo">
   SELECT co.commodityName AS commodityName,s.id AS id,c.`consumptionNumber` AS consumptionNumber
   ,c.consumptionMoney AS consumptionMoney
     FROM `consumptiondetails`  c
     INNER JOIN `stayregister` s ON c.stayRegisterID=s.id
     INNER JOIN `commodity` co ON co.id=c.commodityID
     WHERE s.id=#{id,jdbcType=INTEGER}
  </select>



    <select id="selectByStayId" resultType="com.gx.po.StayRegisterPo">
         SELECT o.`orderID` AS codeNumber,p.name AS NAME,o.status AS ostatus
             FROM `stayregisterdetails` s
             INNER JOIN `stayregister` st ON s.stayRegisterID =st.id
             INNER JOIN `order` o ON o.`stayDetailsId`=s.id
             INNER JOIN `platform` p ON p.id=o.`platformId`
     WHERE st.id=#{id,jdbcType=INTEGER}
     LIMIT 1
    </select>

    <!--   分页条件查询 order -->
    <select id="pageFuzzyselectOrder" resultType="com.gx.po.StayRegisterPo">
       SELECT s.*,p.name AS passengerName,r.roomNumber,r.roomAmount,
    a.attributeDetailsName AS RoomGuestRoomLevelName, ss.id AS stayregisterdetailsId,
    aa.attributeDetailsName AS predetermineReceiveTargeTypeName,
    ab.attributeDetailsName AS passengerTypeName,rt.teamName AS receiveTeamName,
    ss.codeNumber AS codeNumber, pl.name AS platformName
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN platform pl ON pl.id=ss.platformID
    WHERE rt.targetTypeID=#{receiveTargeTypeID,jdbcType=INTEGER}
    AND s.isBillID=#{isBillID,jdbcType=INTEGER}
    and ss.codeNumber like CONCAT('%',#{codeNumber,jdbcType=VARCHAR},'%')
    ORDER BY s.registerTime DESC
    limit #{start},#{pageSize}
  </select>

    <!--   分页条件查询总行数 order -->
    <select id="countFuzzyselectOrder" resultType="java.lang.Integer">
      SELECT count(*) FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN platform pl ON pl.id=ss.platformID
    WHERE s.isBillID=69
     AND ss.codeNumber like CONCAT('%',#{codeNumber,jdbcType=VARCHAR},'%')
      ORDER BY s.registerTime DESC
  </select>


    <!--   分页条件查询 Two -->
    <select id="pageFuzzyselectTwos" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,p.name AS passengerName,r.roomNumber,r.roomAmount,
    a.attributeDetailsName AS RoomGuestRoomLevelName, ss.id AS stayregisterdetailsId,
    aa.attributeDetailsName AS predetermineReceiveTargeTypeName,
    ab.attributeDetailsName AS passengerTypeName,rt.teamName AS receiveTeamName,
     ss.codeNumber AS codeNumber, pl.name AS platformName
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN platform pl ON pl.id=ss.platformID
    WHERE s.receiveTargetID=#{receiveTargetID,jdbcType=INTEGER}
    AND s.isBillID=#{isBillID,jdbcType=INTEGER}
    and ss.codeNumber like CONCAT('%',#{codeNumber,jdbcType=VARCHAR},'%')
    ORDER BY s.registerTime DESC
    limit #{start},#{pageSize}
  </select>

    <!--   分页条件查询总行数 Two -->
    <select id="countFuzzyselectTwos" resultType="java.lang.Integer">
      SELECT count(*) FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN platform pl ON pl.id=ss.platformID
    WHERE s.receiveTargetID=#{receiveTargetID,jdbcType=INTEGER}
    AND s.isBillID=#{isBillID,jdbcType=INTEGER}
    and ss.codeNumber like CONCAT('%',#{codeNumber,jdbcType=VARCHAR},'%')
    ORDER BY s.registerTime DESC
  </select>

    <!--   分页条件查询 Three -->
    <select id="pageFuzzyselectThrees" resultType="com.gx.po.StayRegisterPo">
      SELECT s.*,p.name AS passengerName,r.roomNumber,r.roomAmount,
    a.attributeDetailsName AS RoomGuestRoomLevelName, ss.id AS stayregisterdetailsId,
    aa.attributeDetailsName AS predetermineReceiveTargeTypeName,
    ab.attributeDetailsName AS passengerTypeName,rt.teamName AS receiveTeamName,
     ss.codeNumber AS codeNumber, pl.name AS platformName
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN platform pl ON pl.id=ss.platformID
    WHERE s.receiveTargetID!=2
    AND s.isBillID=#{isBillID,jdbcType=INTEGER}
    and ss.codeNumber like CONCAT('%',#{codeNumber,jdbcType=VARCHAR},'%')
    ORDER BY s.registerTime DESC
    limit #{start},#{pageSize}
  </select>

    <!--   分页条件查询总行数 Three -->
    <select id="countFuzzyselectThrees" resultType="java.lang.Integer">
      SELECT count(*) FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN platform pl ON pl.id=ss.platformID
    WHERE s.receiveTargetID!=2
    AND s.isBillID=#{isBillID,jdbcType=INTEGER}
    and ss.codeNumber like CONCAT('%',#{codeNumber,jdbcType=VARCHAR},'%')
    ORDER BY s.registerTime DESC
  </select>


    <select id="getID" resultType="java.lang.Integer">
        select id from stayregisterdetails where codeNumber=#{codeNumber,jdbcType=VARCHAR}
    </select>

    <select id="orderIDBystayid" resultType="java.lang.String">
        SELECT o.orderID as orderID FROM `stayregister` s
	INNER JOIN `stayregisterdetails` ss ON s.id=ss.`stayRegisterID`
	INNER JOIN `order` o ON o.`stayDetailsId`=ss.id
	WHERE s.id=#{id,jdbcType=INTEGER}
    </select>

    <select id="codeNumberYZ" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM stayregisterdetails WHERE codeNumber=#{codeNumber,jdbcType=VARCHAR}
    </select>

    <select id="selectPredetermineById" resultType="java.lang.Integer">
        SELECT `predetermineID` FROM `stayregister` WHERE id=#{id,jdbcType=INTEGER}
    </select>
    <select id="selectStaCount" resultType="java.lang.Integer">
        SELECT COUNT(*) FROM `stayregister` st
          INNER JOIN `room` r ON r.id=st.`roomID`
          INNER JOIN `supplier` s ON s.id=r.`supplierID`
          WHERE s.id=#{supplierid,jdbcType=INTEGER}
          AND st.`isBillID`=68
    </select>

    <select id="selectStaPlatform" resultType="java.lang.Integer">
       SELECT COUNT(*) FROM `stayregister` st
           INNER JOIN `stayregisterdetails` stt ON st.id=stt.`stayRegisterID`
          INNER JOIN `order` o ON stt.id=o.`stayDetailsId`
          INNER JOIN `platform` p ON p.id=o.`platformId`
          WHERE p.id=#{platformid,jdbcType=INTEGER}
          AND st.`isBillID`=68
    </select>
    <!--确认收款-->
    <select id="confirmReceipt" resultType="java.lang.Integer">
         UPDATE `stayregister` SET `isdao`=#{isdao,jdbcType=INTEGER},
               paymentdate=#{paymentdate,jdbcType=TIMESTAMP}
               WHERE id=#{id,jdbcType=INTEGER}
    </select>

    <select id="fuzzyselectAll" resultType="com.gx.po.StayRegisterPo">
     SELECT s.*,p.name AS passengerName,r.roomNumber,su.supplierName AS supplierName,pl.`name` AS platformName,
	    ss.id AS stayregisterdetailsId,ss.`codeNumber` AS codeNumber
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
	INNER JOIN `platform` pl ON pl.`id`=ss.`platformID`
    WHERE s.isBillID=69 ORDER BY s.registerTime DESC
  </select>

    <!--   分页条件查询总行数 Four -->
    <select id="countAll" resultType="java.lang.Integer">
      SELECT count(*) FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
	INNER JOIN `platform` pl ON pl.`id`=ss.`platformID`
    WHERE s.isBillID=69 ORDER BY s.registerTime DESC
  </select>


    <select id="fuzzyselectAllTwo" resultType="com.gx.po.StayRegisterPo">
     SELECT s.*,p.name AS passengerName,r.roomNumber,su.supplierName AS supplierName,pl.`name` AS platformName,
	    ss.id AS stayregisterdetailsId,ss.`codeNumber` AS codeNumber
	FROM stayregister s
	LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id
	INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
	INNER JOIN `platform` pl ON pl.`id`=ss.`platformID`
    WHERE s.isBillID=69
     AND s.payTime BETWEEN #{min} AND #{max}
     ORDER BY s.registerTime DESC
  </select>

    <!--   分页条件查询总行数 Four -->
    <select id="countAllTwo" resultType="java.lang.Integer">
      SELECT count(*) FROM stayregister s
      LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
    WHERE s.isBillID=69
    AND s.payTime BETWEEN #{min} AND #{max}
    ORDER BY s.registerTime DESC
  </select>

    <select id="selectPayTime" resultType="com.gx.po.StayRegisterPo" >
        SELECT s.*,p.name AS passengerName,r.roomNumber,r.roomAmount,
	    a.attributeDetailsName AS RoomGuestRoomLevelName, ss.id AS stayregisterdetailsId,
	    aa.attributeDetailsName AS predetermineReceiveTargeTypeName,
	    ab.attributeDetailsName AS passengerTypeName,rt.teamName AS receiveTeamName,
	    s.predetermineID AS predetermineID,su.`supplierName` AS supplierName
	    ,ss.`codeNumber` AS `codeNumber`
	FROM stayregister s LEFT OUTER JOIN stayregisterdetails ss ON s.id=ss.stayRegisterID
	LEFT OUTER JOIN passenger p ON ss.passengerID = p.id
	INNER JOIN room r ON s.roomID=r.id INNER JOIN attributedetails a ON r.guestRoomLevelID=a.id
	LEFT OUTER JOIN receivetarget rt ON s.receiveTargetID=rt.id
	LEFT OUTER JOIN attributedetails aa ON rt.targetTypeID= aa.id
	LEFT OUTER JOIN attributedetails ab ON s.passengerTypeID=ab.id
	INNER JOIN `supplier` su ON su.id=r.`supplierID`
	WHERE s.isBillID=68
    </select>



    <update id="regiserTime" parameterType="com.gx.po.StayRegisterPo">
        UPDATE `stayregister`
        SET `registerTime` = #{registerTime,jdbcType=TIMESTAMP}
        WHERE id= #{id,jdbcType=INTEGER}
    </update>

    <!--根据入住id查询明细-->
    <select id="selectSP" resultType="com.gx.po.StayRegisterPo" >
        SELECT s.*,ss.*  FROM `stayregister` s INNER JOIN `stayregisterdetails` ss ON s.`id`=ss.`stayRegisterID`
	WHERE s.`id`= #{id,jdbcType=INTEGER}
    </select>



    <!--  结账-->
    <update id="pay2" >
    UPDATE stayregister SET
                                 payTime=#{payTime,jdbcType=TIMESTAMP},
                                 `currency`=#{currency,jdbcType=INTEGER},
                                 isBillID=69
         WHERE id = #{id,jdbcType=INTEGER}
   </update>

    <select id="getsID" resultType="com.gx.po.StayRegisterPo">
        select * from stayregisterdetails where codeNumber=#{codeNumber,jdbcType=VARCHAR}
    </select>
</mapper>